<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <meta
      name='viewport'
      content='width=device-width, initial-scale=1.0'
    />
    <title>{{site.title}}</title>
    <link rel='icon' href='/images/favicon.png' />
    <script type='module' src='/scripts/main.ts'></script>

    <style>
      .c-contact-layout {

      }
    </style>
  </head>
  <body style='opacity: 0' data-barba='wrapper'>

    <c-navbar>
      <a href='/'>
        <img src='{{site.logo_header}}' />
      </a>
    </c-navbar>

    <c-nav-menu navLinks='{{site.menu_items}}'>
    </c-nav-menu>

    <div data-scroll-container class="u-will-change-transform-opacity">

      <main
        data-barba='container'
        data-barba-namespace='contact'
        asscroll
      >

        <!--
        <c-bounce-title
          class='u-margin-navbar-top'
          text='{{site.contact_heading}}'
        >
        </c-bounce-title>
        -->

        <section class='c-contact'>

          <div class='c-contact__info'>

          </div>

          <form
            class='c-form js-contact-form'
            name='contact'
            method='POST'
            data-netlify='true'
            autocomplete='off'
          >

            <h2 class='
              u-heading-huge
              u-margin-9-bottom
            '>
              {{site.contact_heading}}
            </h2>

            <h2 class='
              c-form__heading
            '>
              {{site.contact_type_heading}}
            </h2>

            <div class='c-form__field'>

              {{#each site.contact_project_types}}

                <input
                  type='checkbox'
                  id='type{{@index}}'
                  name='type{{@index}}'
                  class='c-toggle__input'
                >

                <label
                  for='type{{@index}}'
                  class='c-toggle__label u-margin-2-right u-margin-2-bottom'
                >

                  <div class='c-toggle__filler'></div>

                  <span class='c-toggle__text'>

                    <span class='c-toggle__text-inner'>
                      {{this.name}}
                    </span>

                  </span>

                </label>

              {{/each}}

            </div>

            <div class='c-form__line-field'>
              <input
                class='js-input'
                type='text'
                name='name'
                required
              />
              <label>your name</label>
            </div>

            <div class='c-form__line-field'>
              <input
                class='js-input'
                type='email'
                name='email'
                required
              />
              <label>your email</label>
            </div>

            <div class='c-form__line-field'>
              <div class='c-form__grow-wrap'>
                <textarea
                  class='js-input'
                  onInput='this.parentNode.dataset.replicatedValue = this.value'
                  name='message'
                  rows='1'
                  required
                ></textarea>
                <label>your message</label>
              </div>
            </div>


            <h2 class='
              c-form__heading
            '>
              project budget
            </h2>

            <div class='c-form__field u-margin-7-bottom'>

              {{#each  site.contact_prices}}

                <input
                  type='checkbox'
                  id='price{{@index}}'
                  name='price{{@index}}'
                  class='c-toggle__input'
                >
                <label for='price{{@index}}' class='c-toggle__label u-margin-2-right u-margin-2-bottom'>

                  <div class='c-toggle__filler'></div>

                  <span class='c-toggle__text'>

                    <span class='c-toggle__text-inner'>
                      {{this.name}}
                    </span>

                  </span>

                </label>

              {{/each}}
            </div>

            <button class='c-button' type='submit'>

              <div class='c-button__filler'></div>

              <span class='c-button__text'>

                <span class='c-button__text-inner'>
                  send
                </span>

              </span>

            </button>

          </form>

        </section>

      </main>

      <div
        class='
          c-overlay
          js-confirm-overlay
        '
        data-hidden=true
      >
        <figure class='
          c-overlay__figure
          js-confirm-animation
        '>
        </figure>
        <h3 class='
          c-overlay__heading
        '>
          {{site.contact_form_success_heading}}
        </h3>
        {{site.contact_form_success_text}}
      </div>

      <c-cursor>
      </c-cursor>

      <svg style="display: none" xmlns='http://www.w3.org/2000/svg' version='1.1' class='svg-filters'>
        <defs>
          <filter id="filter-goo-4">
            <feGaussianBlur in="SourceGraphic" stdDeviation="7" result="blur" x="0" />
            <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo" />
          </filter>
        </defs>
      </svg>

      <c-footer
        socialLinks='{{site.social_links}}'
        navLinks='{{site.menu_items}}'
        logo='{{site.logo_footer}}'
        asscroll
      >
        <div slot='heading' class='u-heading-huge'>
          {{{site.footer_heading}}}
        </div>
      </c-footer>

    </div>

    <script type='module'>

      import lottie from 'lottie-web'

      const contactForm = document.querySelector(
        '.js-contact-form'
      )

      if (contactForm) {
        const serialize = function (form) {
          let field
          let l
          let s = []

          if (
            typeof form == 'object' &&
            form.nodeName.toLowerCase() == 'form'
          ) {

            const len = form.elements.length

            for (let i = 0; i < len; i++) {
              field = form.elements[i]
              if (
                field.name &&
                !field.disabled &&
                field.type != 'button' &&
                field.type != 'file' &&
                field.type != 'hidden' &&
                field.type != 'reset' &&
                field.type != 'submit'
              ) {
                if (field.type == 'select-multiple') {
                  l = form.elements[i].options.length

                  for (let j = 0; j < l; j++) {
                    if (field.options[j].selected) {
                      s[s.length] =
                        encodeURIComponent(field.name) +
                        '=' +
                        encodeURIComponent(
                          field.options[j].value
                        )
                    }
                  }
                } else if (
                  (field.type != 'checkbox' &&
                    field.type != 'radio') ||
                  field.checked
                ) {
                  s[s.length] =
                    encodeURIComponent(field.name) +
                    '=' +
                    encodeURIComponent(field.value)
                }
              }
            }
          }
          return s.join('&').replace(/%20/g, '+')

        }

        contactForm.addEventListener('submit', e => {

          e.preventDefault()

          const theForm = e.currentTarget

          const formData =
            'form-name=' +
            e.target.getAttribute('name') +
            '&' +
            serialize(theForm)

          console.log(formData)

          const options = {
            method: 'POST',
            headers: {
              'Content-Type':
                'application/x-www-form-urlencoded'
            },
            body: formData
          }

          fetch('/', options)
            .then(function (response) {

              console.log(response)

              handleConfirm()

            })
            .catch(function (error) {

              console.log(error)

            })

        })

      }

        const confirmOverlayEl = document.querySelector(
          '.js-confirm-overlay'
        )

        const confirmAnimationEl = document.querySelector(
          '.js-confirm-animation'
        )

        const confirmAnimation = lottie.loadAnimation({
          container: confirmAnimationEl,
          renderer: 'canvas',
          loop: false,
          autoplay: false,
          path: '/animations/mail.json',
          rendererSettings: {
            preserveAspectRatio: 'none'
          }
        })

      function handleConfirm() {

        confirmOverlayEl.dataset.hidden = false

        confirmAnimation.goToAndPlay(1, true)

        confirmAnimation.onComplete = () => {

          setTimeout(() => {

            confirmOverlayEl.dataset.hidden = true
            contactForm.reset()

          }, 5000)

        }

      }

      [].slice
        .call(
          document.querySelectorAll('.js-input')
        )
        .forEach(function (inputEl) {
          if (inputEl.value.trim() !== '') {

            if (
              inputEl.tagName.toLowerCase() === 'textarea'
            ) {

              inputEl.parentElement.parentElement
                .dataset.filled = true

            }
            else {

              inputEl.parentElement.dataset.filled = true

            }

          }

          inputEl.addEventListener('focus', onInputFocus)
          inputEl.addEventListener('blur', onInputBlur)
        })

      function onInputFocus(e) {

        if (
          e.target.tagName.toLowerCase() === 'textarea'
        ) {

          e.target.parentElement.parentElement
            .dataset.focus = true
          e.target.parentElement.parentElement
            .dataset.filled = true

        }
        else {

          e.target.parentElement.dataset.focus = true
          e.target.parentElement.dataset.filled = true

        }

      }

      function onInputBlur(e) {

        if (
          e.target.tagName.toLowerCase() === 'textarea'
        ) {

          e.target.parentElement.parentElement
            .dataset.focus = false

          if (e.target.value.trim() === '') {

            e.target.parentElement.parentElement
              .dataset.filled = false

          }

        }
        else {

          e.target.parentElement.dataset.focus = false

          if (e.target.value.trim() === '') {

            e.target.parentElement.dataset.filled = false

          }

        }


      }

    </script>

    <script
      src='https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.3/p5.min.js'
      integrity='sha512-xrAcaPlDVY5TDNAKKsVPf040TnCatM3YFUi/AChhyBLJ1IVn+lbAKTiVDjhicrUFPqz/IvC0S2uVlbi7iF6I7w=='
      crossorigin='anonymous'
      referrerpolicy='no-referrer'
    ></script>

  </body>
</html>
