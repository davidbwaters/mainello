<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <meta
      name='viewport'
      content='width=device-width, initial-scale=1.0'
    />
    <title>{{site.title}}</title>
    <link rel='icon' href='/images/favicon.png' />
    <script type='module' src='/scripts/main.ts'></script>
  </head>
  <body style='opacity: 0' data-barba='wrapper'>

    <c-navbar>
      <a href='/'>
        <img src='{{site.logo_header}}' />
      </a>
    </c-navbar>

    <c-nav-menu navLinks='{{site.menu_items}}'>
    </c-nav-menu>

    <div asscroll-container>

      <main
        data-barba='container'
        data-barba-namespace='contact'
        asscroll
      >

        <c-bounce-title
          class='u-margin-navbar-top'
          text='{{site.contact_heading}}'
        >
        </c-bounce-title>

        <form
          class='c-form js-contact-form'
          name='contact'
          method='POST'
          data-netlify='true'
          autocomplete='off'
        >

          <div class='c-form__field'>
            <input
              class='js-input'
              type='text'
              name='name'
              autocomplete='new-password'
            />
            <label>your name</label>
          </div>

          <div class='c-form__field'>
            <input
              class='js-input'
              type='email'
              name='email'
              autocomplete='new-password'
            />
            <label>your email</label>
          </div>

          <div class='c-form__field'>
            <div class='c-form__grow-wrap'>
              <textarea
                class='js-input'
                onInput='this.parentNode.dataset.replicatedValue = this.value'
                name='message'
                rows='1'
              ></textarea>
              <label>your message</label>
            </div>
          </div>

          <c-button text='send' type='submit' large>
          </c-button>

        </form>

      </main>

      <div
        class='
          c-overlay
          js-confirm-overlay
        '
        data-hidden=true
      >
        <figure class='
          c-overlay__figure
          js-confirm-animation
        '>
        </figure>
        <h3 class='
          c-overlay__heading
        '>
          success!
        </h3>
        <p>
          thanks for reaching out.  you'll hear from us
          shortly.
        </p>
      </div>

      <svg
        class='c-cursor'
        width='25'
        height='25'
        viewBox='0 0 25 25'
      >
        <circle
          class='c-cursor__inner'
          cx='12.5'
          cy='12.5'
          r='6.25'
        />
      </svg>

      <svg xmlns='http://www.w3.org/2000/svg' version='1.1' class='svg-filters'>
        <defs>
          <filter id="filter-goo-4">
            <feGaussianBlur in="SourceGraphic" stdDeviation="7" result="blur" x="0" />
            <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo" />
          </filter>
        </defs>
      </svg>

      <c-footer
        socialLinks='{{site.social_links}}'
        navLinks='{{site.menu_items}}'
        logo='{{site.logo_footer}}'
        asscroll
      >
        <div slot='heading' class='u-heading-huge-fluid'>
          {{{site.footer_heading}}}
        </div>
      </c-footer>

    </div>

    <script type='module'>

      import lottie from 'lottie-web'

      const contactForm = document.querySelector(
        '.js-contact-form'
      )

      if (contactForm) {
        const serialize = function (form) {
          let field
          let l
          let s = []

          if (
            typeof form == 'object' &&
            form.nodeName.toLowerCase() == 'form'
          ) {

            const len = form.elements.length

            for (let i = 0; i < len; i++) {
              field = form.elements[i]
              if (
                field.name &&
                !field.disabled &&
                field.type != 'button' &&
                field.type != 'file' &&
                field.type != 'hidden' &&
                field.type != 'reset' &&
                field.type != 'submit'
              ) {
                if (field.type == 'select-multiple') {
                  l = form.elements[i].options.length

                  for (let j = 0; j < l; j++) {
                    if (field.options[j].selected) {
                      s[s.length] =
                        encodeURIComponent(field.name) +
                        '=' +
                        encodeURIComponent(
                          field.options[j].value
                        )
                    }
                  }
                } else if (
                  (field.type != 'checkbox' &&
                    field.type != 'radio') ||
                  field.checked
                ) {
                  s[s.length] =
                    encodeURIComponent(field.name) +
                    '=' +
                    encodeURIComponent(field.value)
                }
              }
            }
          }
          return s.join('&').replace(/%20/g, '+')

        }

        contactForm.addEventListener('submit', e => {

          e.preventDefault()

          const theForm = e.currentTarget

          const formData =
            'form-name=' +
            theForm.name +
            '&' +
            serialize(theForm)

          const options = {
            method: 'POST',
            headers: {
              'Content-Type':
                'application/x-www-form-urlencoded'
            },
            body: formData
          }

          fetch('/', options)
            .then(function (response) {

              handleConfirm()

            })
            .catch(function (error) {

              console.log(error)

            })

        })

      }

      function handleConfirm() {

        const confirmOverlayEl = document.querySelector(
          '.js-confirm-overlay'
        )

        const confirmAnimationEl = document.querySelector(
          '.js-confirm-animation'
        )

        const confirmAnimation = lottie.loadAnimation({
          container: confirmAnimationEl,
          renderer: 'canvas',
          loop: false,
          autoplay: false,
          path: '/animations/mail.json',
          rendererSettings: {
            preserveAspectRatio: 'none'
          }
        })

        confirmOverlayEl.dataset.hidden = false

        confirmAnimation.goToAndPlay(1, true)

        confirmAnimation.onComplete = () => {

          setTimeout(() => {

            confirmOverlayEl.dataset.hidden = true

          }, 5000)

        }

      }

      ;[].slice
        .call(
          document.querySelectorAll('.js-input')
        )
        .forEach(function (inputEl) {
          if (inputEl.value.trim() !== '') {

            if (
              inputEl.tagName.toLowerCase() === 'textarea'
            ) {

              inputEl.parentElement.parentElement
                .dataset.filled = true

            }
            else {

              inputEl.parentElement.dataset.filled = true

            }

          }

          inputEl.addEventListener('focus', onInputFocus)
          inputEl.addEventListener('blur', onInputBlur)
        })

      function onInputFocus(e) {

        if (
          e.target.tagName.toLowerCase() === 'textarea'
        ) {

          e.target.parentElement.parentElement
            .dataset.focus = true
          e.target.parentElement.parentElement
            .dataset.filled = true

        }
        else {

          e.target.parentElement.dataset.focus = true
          e.target.parentElement.dataset.filled = true

        }

      }

      function onInputBlur(e) {

        if (
          e.target.tagName.toLowerCase() === 'textarea'
        ) {

          e.target.parentElement.parentElement
            .dataset.focus = false

          if (e.target.value.trim() === '') {

            e.target.parentElement.parentElement
              .dataset.filled = false

          }

        }
        else {

          e.target.parentElement.dataset.focus = false

          if (e.target.value.trim() === '') {

            e.target.parentElement.dataset.filled = false

          }

        }


      }

    </script>

    <script
      src='https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.3/p5.min.js'
      integrity='sha512-xrAcaPlDVY5TDNAKKsVPf040TnCatM3YFUi/AChhyBLJ1IVn+lbAKTiVDjhicrUFPqz/IvC0S2uVlbi7iF6I7w=='
      crossorigin='anonymous'
      referrerpolicy='no-referrer'
    ></script>

  </body>
</html>
